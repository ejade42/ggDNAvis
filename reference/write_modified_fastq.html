<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-GB"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Write modification information stored in dataframe back to modified FASTQ — write_modified_fastq • ggDNAvis</title><!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png"><link rel="icon" type="”image/svg+xml”" href="../favicon.svg"><link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png"><link rel="icon" sizes="any" href="../favicon.ico"><link rel="manifest" href="../site.webmanifest"><!-- katex math --><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css" integrity="sha384-nB0miv6/jRmo5UMMR1wu3Gz6NLsoTkbqJghGIsx//Rlm+ZU03BU6SQNC66uf4l5+" crossorigin="anonymous"><script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js" integrity="sha384-7zkQWkzuo3B5mTepMUcHkMB5jZaolc2xDwL6VFqjFALcbeS9Ggm/Yr2r3Dy4lfFg" crossorigin="anonymous"></script><script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/auto-render.min.js" integrity="sha384-43gviWU0YVjaDtb/GhzOouOXtZMP/7XUzwPTstBeZFe/+rCMvRwr4yROQP43s0Xk" crossorigin="anonymous" onload="renderMathInElement(document.body);"></script><script src="../katex-auto.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet"><meta property="og:title" content="Write modification information stored in dataframe back to modified FASTQ — write_modified_fastq"><meta name="description" content="This function takes a dataframe containing DNA modification information
(e.g. produced by read_modified_fastq()) and writes it back to modified
FASTQ, equivalent to what would be produced via samtools fastq -T MM,ML.
Arguments give the names of columns within the dataframe from which to read.
If multiple types of modification have been assessed (e.g. both methylation
and hydroxymethylation), then multiple colnames must be provided for locations
and probabilites, and multiple prefixes (e.g. &quot;C+h?&quot;) must be provided.
IMPORTANT: These three vectors must all be the same length, and the modification
types must be in a consistent order (e.g. if writing hydroxymethylation and methylation
in that order, must do H then M in all three vectors and never vice versa).
If quality isn't known (e.g. there was a FASTA step at some point in the pipeline),
the quality argument can be set to NA to fill in quality scores with &quot;B&quot;. This
is the same behaviour as SAMtools v1.21 when converting FASTA to SAM/BAM then FASTQ.
I don't really know why SAMtools decided the default quality should be &quot;B&quot; but there
was probably a reason so I have stuck with that.
Default arguments are set up to work with the included example_many_sequences data."><meta property="og:description" content="This function takes a dataframe containing DNA modification information
(e.g. produced by read_modified_fastq()) and writes it back to modified
FASTQ, equivalent to what would be produced via samtools fastq -T MM,ML.
Arguments give the names of columns within the dataframe from which to read.
If multiple types of modification have been assessed (e.g. both methylation
and hydroxymethylation), then multiple colnames must be provided for locations
and probabilites, and multiple prefixes (e.g. &quot;C+h?&quot;) must be provided.
IMPORTANT: These three vectors must all be the same length, and the modification
types must be in a consistent order (e.g. if writing hydroxymethylation and methylation
in that order, must do H then M in all three vectors and never vice versa).
If quality isn't known (e.g. there was a FASTA step at some point in the pipeline),
the quality argument can be set to NA to fill in quality scores with &quot;B&quot;. This
is the same behaviour as SAMtools v1.21 when converting FASTA to SAM/BAM then FASTQ.
I don't really know why SAMtools decided the default quality should be &quot;B&quot; but there
was probably a reason so I have stuck with that.
Default arguments are set up to work with the included example_many_sequences data."><meta property="og:image" content="https://ejade42.github.io/ggDNAvis/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">ggDNAvis</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.3.2</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-version" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Version</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-version"><li><a class="dropdown-item" href="https://ejade42.github.io/ggDNAvis/">Latest release</a></li>
    <li><a class="dropdown-item" href="https://ejade42.github.io/ggDNAvis/dev/">Latest dev</a></li>
    <li><a class="dropdown-item" href="https://ejade42.github.io/ggDNAvis/v0.3.2/">v0.3.2</a></li>
    <li><a class="dropdown-item" href="https://ejade42.github.io/ggDNAvis/v0.3.1/">v0.3.1</a></li>
    <li><a class="dropdown-item" href="https://ejade42.github.io/ggDNAvis/v0.3.0/">v0.3.0</a></li>
    <li><a class="dropdown-item" href="https://ejade42.github.io/ggDNAvis/v0.2.1/">v0.2.1</a></li>
    <li><a class="dropdown-item" href="https://ejade42.github.io/ggDNAvis/v0.2.0/">v0.2.0</a></li>
  </ul></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/ejade42/ggDNAvis/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Write modification information stored in dataframe back to modified FASTQ</h1>
      <small class="dont-index">Source: <a href="https://github.com/ejade42/ggDNAvis/blob/main/R/parse_methylation_from_fastq.R" class="external-link"><code>R/parse_methylation_from_fastq.R</code></a></small>
      <div class="d-none name"><code>write_modified_fastq.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>This function takes a dataframe containing DNA modification information
(e.g. produced by <code><a href="read_modified_fastq.html">read_modified_fastq()</a></code>) and writes it back to modified
FASTQ, equivalent to what would be produced via <code>samtools fastq -T MM,ML</code>.<br><br>
Arguments give the names of columns within the dataframe from which to read.<br><br>
If multiple types of modification have been assessed (e.g. both methylation
and hydroxymethylation), then multiple colnames must be provided for locations
and probabilites, and multiple prefixes (e.g. <code>"C+h?"</code>) must be provided.
<strong>IMPORTANT:</strong> These three vectors must all be the same length, and the modification
types must be in a consistent order (e.g. if writing hydroxymethylation and methylation
in that order, must do H then M in all three vectors and never vice versa).<br><br>
If quality isn't known (e.g. there was a FASTA step at some point in the pipeline),
the <code>quality</code> argument can be set to <code>NA</code> to fill in quality scores with <code>"B"</code>. This
is the same behaviour as SAMtools v1.21 when converting FASTA to SAM/BAM then FASTQ.
I don't really know why SAMtools decided the default quality should be "B" but there
was probably a reason so I have stuck with that.<br><br>
Default arguments are set up to work with the included <code><a href="example_many_sequences.html">example_many_sequences</a></code> data.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">write_modified_fastq</span><span class="op">(</span></span>
<span>  <span class="va">dataframe</span>,</span>
<span>  filename <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>  read_id_colname <span class="op">=</span> <span class="st">"read"</span>,</span>
<span>  sequence_colname <span class="op">=</span> <span class="st">"sequence"</span>,</span>
<span>  quality_colname <span class="op">=</span> <span class="st">"quality"</span>,</span>
<span>  locations_colnames <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"hydroxymethylation_locations"</span>, <span class="st">"methylation_locations"</span><span class="op">)</span>,</span>
<span>  probabilities_colnames <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"hydroxymethylation_probabilities"</span>,</span>
<span>    <span class="st">"methylation_probabilities"</span><span class="op">)</span>,</span>
<span>  modification_prefixes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"C+h?"</span>, <span class="st">"C+m?"</span><span class="op">)</span>,</span>
<span>  include_blank_tags <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  return <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-dataframe">dataframe<a class="anchor" aria-label="anchor" href="#arg-dataframe"></a></dt>
<dd><p><code>dataframe</code>. Dataframe containing modification information to write back to modified FASTQ. Must have columns for unique read ID, DNA sequence, and at least one set of locations and probabilities for a particular modification type (e.g. 5C methylation).</p></dd>


<dt id="arg-filename">filename<a class="anchor" aria-label="anchor" href="#arg-filename"></a></dt>
<dd><p><code>character</code>. File to write the modified FASTQ to. Recommended to end with <code>.fastq</code> (warns but works if not). If set to <code>NA</code> (default), no file will be output, which may be useful for testing/debugging.</p></dd>


<dt id="arg-read-id-colname">read_id_colname<a class="anchor" aria-label="anchor" href="#arg-read-id-colname"></a></dt>
<dd><p><code>character</code>. The name of the column within the dataframe that contains the unique ID for each read. Defaults to <code>"read"</code>.</p></dd>


<dt id="arg-sequence-colname">sequence_colname<a class="anchor" aria-label="anchor" href="#arg-sequence-colname"></a></dt>
<dd><p><code>character</code>. The name of the column within the dataframe that contains the DNA sequence for each read. Defaults to <code>"sequence"</code>.<br><br> The values within this column must be DNA sequences e.g. <code>"GGCGGC"</code>.</p></dd>


<dt id="arg-quality-colname">quality_colname<a class="anchor" aria-label="anchor" href="#arg-quality-colname"></a></dt>
<dd><p><code>character</code>. The name of the column within the dataframe that contains the FASTQ quality scores for each read. Defaults to <code>"quality"</code>. If scores are not known, can be set to <code>NA</code> to fill in quality with <code>"B"</code>.<br><br> If not <code>NA</code>, must correspond to a column where the values are the FASTQ quality scores e.g. <code>"$12\"&gt;/2C;4:9F8:816E,6C3*,"</code> - see <code><a href="fastq_quality_scores.html">fastq_quality_scores</a></code>.</p></dd>


<dt id="arg-locations-colnames">locations_colnames<a class="anchor" aria-label="anchor" href="#arg-locations-colnames"></a></dt>
<dd><p><code>character vector</code>. Vector of the names of all columns within the dataframe that contain modification locations. Defaults to <code>c("hydroxymethylation_locations", "methylation_locations")</code>.<br><br> The values within these columns must be comma-separated strings of indices at which modification was assessed, as produced by <code><a href="vector_to_string.html">vector_to_string()</a></code>, e.g. <code>"3,6,9,12"</code>.<br><br> Will fail if these locations are not instances of the target base (e.g. <code>"C"</code> for <code>"C+m?"</code>), as the SAMtools tag system does not work otherwise. One consequence of this is that if sequences have been reversed via <code><a href="merge_methylation_with_metadata.html">merge_methylation_with_metadata()</a></code> or helpers, they cannot be written to FASTQ <em>unless</em> modification locations are symmetric e.g. CpG <em>and</em> offset was set to <code>1</code> when reversing (see <code><a href="reverse_locations_if_needed.html">reverse_locations_if_needed()</a></code>).</p></dd>


<dt id="arg-probabilities-colnames">probabilities_colnames<a class="anchor" aria-label="anchor" href="#arg-probabilities-colnames"></a></dt>
<dd><p><code>character vector</code>. Vector of the names of all columns within the dataframe that contain modification probabilities. Defaults to <code>c("hydroxymethylation_probabilities", "methylation_probabilities")</code>.<br><br> The values within the columns must be comma-separated strings of modification probabilities, as produced by <code><a href="vector_to_string.html">vector_to_string()</a></code>, e.g. <code>"0,255,128,78"</code>.</p></dd>


<dt id="arg-modification-prefixes">modification_prefixes<a class="anchor" aria-label="anchor" href="#arg-modification-prefixes"></a></dt>
<dd><p><code>character vector</code>. Vector of the prefixes to be used for the MM tags specifying modification type. These are usually generated by Dorado/Guppy based on the original modified basecalling settings, and more details can be found in the SAM optional tag specifications. Defaults to <code>c("C+h?", "C+m?")</code>.<br><br><code>locations_colnames</code>, <code>probabilities_colnames</code>, and <code>modification_prefixes</code> must all have the same length e.g. 2 if there were 2 modification types assessed.</p></dd>


<dt id="arg-include-blank-tags">include_blank_tags<a class="anchor" aria-label="anchor" href="#arg-include-blank-tags"></a></dt>
<dd><p><code>logical</code>. Boolean specifying what to do if a particular read has no assessed locations for a given modification type from <code>modification_prefixes</code>.<br><br> If <code>TRUE</code> (default), blank tags will be written e.g. <code>"C+h?;"</code> (whereas a normal, non-blank tag looks like <code>"C+h?,0,0,0,0;"</code>). If <code>FALSE</code>, tags with no assessed locations in that read will not be written at all.</p></dd>


<dt id="arg-return">return<a class="anchor" aria-label="anchor" href="#arg-return"></a></dt>
<dd><p><code>logical</code>. Boolean specifying whether this function should return the FASTQ (as a character vector of each line in the FASTQ), otherwise it will return <code>invisible(NULL)</code>. Defaults to <code>FALSE</code>.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p><code>character vector</code>. The resulting modified FASTQ file as a character vector of its constituent lines (or <code>invisible(NULL)</code> if <code>return</code> is <code>FALSE</code>). This is probably mostly useful for debugging, as setting <code>filename</code> within this function directly writes to FASTQ via <code><a href="https://rdrr.io/r/base/writeLines.html" class="external-link">writeLines()</a></code>. Therefore, defaults to returning <code>invisible(NULL)</code>.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co">## Write to FASTQ (using filename = NA, return = FALSE</span></span></span>
<span class="r-in"><span><span class="co">## to view as char vector rather than writing to file)</span></span></span>
<span class="r-in"><span><span class="fu">write_modified_fastq</span><span class="op">(</span></span></span>
<span class="r-in"><span>    <span class="va">example_many_sequences</span>,</span></span>
<span class="r-in"><span>    filename <span class="op">=</span> <span class="cn">NA</span>,</span></span>
<span class="r-in"><span>    read_id_colname <span class="op">=</span> <span class="st">"read"</span>,</span></span>
<span class="r-in"><span>    sequence_colname <span class="op">=</span> <span class="st">"sequence"</span>,</span></span>
<span class="r-in"><span>    quality_colname <span class="op">=</span> <span class="st">"quality"</span>,</span></span>
<span class="r-in"><span>    locations_colnames <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"hydroxymethylation_locations"</span>,</span></span>
<span class="r-in"><span>                           <span class="st">"methylation_locations"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    probabilities_colnames <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"hydroxymethylation_probabilities"</span>,</span></span>
<span class="r-in"><span>                               <span class="st">"methylation_probabilities"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    modification_prefixes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"C+h?"</span>, <span class="st">"C+m?"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    return <span class="op">=</span> <span class="cn">TRUE</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in write_modified_fastq(example_many_sequences, filename = NA, read_id_colname = "read",     sequence_colname = "sequence", quality_colname = "quality",     locations_colnames = c("hydroxymethylation_locations", "methylation_locations"),     probabilities_colnames = c("hydroxymethylation_probabilities",         "methylation_probabilities"), modification_prefixes = c("C+h?",         "C+m?"), return = TRUE):</span> object 'locations_colname' not found</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Write methylation only, and fill in qualities with "B"</span></span></span>
<span class="r-in"><span><span class="fu">write_modified_fastq</span><span class="op">(</span></span></span>
<span class="r-in"><span>    <span class="va">example_many_sequences</span>,</span></span>
<span class="r-in"><span>    filename <span class="op">=</span> <span class="cn">NA</span>,</span></span>
<span class="r-in"><span>    read_id_colname <span class="op">=</span> <span class="st">"read"</span>,</span></span>
<span class="r-in"><span>    sequence_colname <span class="op">=</span> <span class="st">"sequence"</span>,</span></span>
<span class="r-in"><span>    quality_colname <span class="op">=</span> <span class="cn">NA</span>,</span></span>
<span class="r-in"><span>    locations_colnames <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"methylation_locations"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    probabilities_colnames <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"methylation_probabilities"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    modification_prefixes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"C+m?"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    return <span class="op">=</span> <span class="cn">TRUE</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in write_modified_fastq(example_many_sequences, filename = NA, read_id_colname = "read",     sequence_colname = "sequence", quality_colname = NA, locations_colnames = c("methylation_locations"),     probabilities_colnames = c("methylation_probabilities"),     modification_prefixes = c("C+m?"), return = TRUE):</span> object 'locations_colname' not found</span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Evelyn Jade.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer></div>





  </body></html>

